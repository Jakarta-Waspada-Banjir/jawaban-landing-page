import L from "leaflet";
import { Marker, Popup } from "react-leaflet";

import { Card, CardContent, CardHeader } from "@/components/ui";
import { initialRainfallPost } from "@/data/FloodInformationMap";
import { formatDate } from "@/utils";

const markerRainfallPost = L.divIcon({
  html: `<svg width="25" height="37" viewBox="0 0 34 46" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clipPath="url(#clip0_2008_1151)">
<circle cx="17.5" cy="15.5" r="9.5" fill="#7E7E7E" />
<path d="M17 0.5C12.6239 0.5 8.42709 2.23839 5.33274 5.33274C2.23839 8.42709 0.5 12.6239 0.5 17C0.5 25.715 15.2 44.15 15.83 44.945C15.9706 45.1202 16.1487 45.2616 16.3512 45.3587C16.5537 45.4559 16.7754 45.5063 17 45.5063C17.2246 45.5063 17.4463 45.4559 17.6488 45.3587C17.8513 45.2616 18.0294 45.1202 18.17 44.945C18.8 44.15 33.5 25.715 33.5 17C33.5 12.6239 31.7616 8.42709 28.6673 5.33274C25.5729 2.23839 21.3761 0.5 17 0.5ZM17 24.5C15.22 24.5 13.4799 23.9722 11.9999 22.9832C10.5198 21.9943 9.36627 20.5887 8.68509 18.9442C8.0039 17.2996 7.82567 15.49 8.17293 13.7442C8.5202 11.9984 9.37737 10.3947 10.636 9.13604C11.8947 7.87737 13.4984 7.0202 15.2442 6.67293C16.99 6.32567 18.7996 6.5039 20.4442 7.18508C22.0887 7.86627 23.4943 9.01983 24.4832 10.4999C25.4722 11.9799 26 13.72 26 15.5C26 17.8869 25.0518 20.1761 23.364 21.864C21.6761 23.5518 19.3869 24.5 17 24.5Z" fill="#7E7E7E" />
<path d="M17 0.5V6.5V11C17 11 17 12.6131 17 15C17 17.3869 17.0002 18.5 17.0002 21C16.9998 23 17 23 17 24.5V45.5C17.2253 45.499 17.4475 45.4472 17.65 45.3485C17.8526 45.2498 18.0303 45.1068 18.17 44.93C18.8 44.15 33.5 25.715 33.5 17C33.5 12.6239 31.7616 8.42709 28.6673 5.33274C25.5729 2.23839 21.3761 0.5 17 0.5Z" fill="#646565" />
<path d="M9.75809 12.5541C12.5345 12.5541 11.3448 10.5713 13.7236 9.38165C14.9133 8.58855 16.6043 9.4511 16.6599 9.38154C18.8788 6.60579 22.8514 7.00223 24.8342 9.3815C26.5966 11.4964 26.0238 13.9022 26.0238 13.9022C26.0238 13.9022 27.8175 15.8015 27.61 17.3126C27.3892 18.9205 24.8342 20.4057 24.8342 20.4057H8.17898C8.17898 20.4057 6.20291 19.2953 5.40298 17.3126C4.60305 15.3298 6.98276 13.7437 7.77602 13.7437C8.56913 13.7437 8.96552 12.5541 9.75809 12.5541Z" fill="white" />
<path d="M20.8621 7C20.8035 7.00059 20.7458 7.01412 20.6931 7.03965C19.0831 7.09358 17.6096 7.85653 16.5976 9.10329C16.0741 8.81698 15.5142 8.58621 14.9138 8.58621C12.9881 8.58621 11.4321 10.1296 11.3686 12.0402C11.0958 11.9347 10.8491 11.7594 10.5533 11.7586H10.5517C9.53893 11.7586 8.72441 12.4494 8.38893 13.3805C6.5069 13.4788 5 15.0064 5 16.9138C5 18.8839 6.5989 20.4828 8.56897 20.4828H24.431C26.4011 20.4828 28 18.8839 28 16.9138C28 15.6107 27.2513 14.5344 26.2092 13.9126C26.3234 13.4669 26.413 13.0125 26.4138 12.5517C26.4138 9.5411 23.9972 7.11102 21.0064 7.02933C20.9606 7.01062 20.9116 7.00068 20.8621 7ZM20.8621 7.7931C21.606 7.79215 22.3397 7.96585 23.0042 8.30022C23.6687 8.63458 24.2455 9.12027 24.688 9.71821C25.1306 10.3161 25.4266 11.0096 25.5522 11.7428C25.6778 12.4761 25.6296 13.2285 25.4113 13.9397C25.3837 14.0306 25.3896 14.1284 25.4281 14.2153C25.4665 14.3022 25.5349 14.3724 25.6207 14.4132C26.5589 14.8589 27.2069 15.8003 27.2069 16.9138C27.2069 18.458 25.976 19.6897 24.431 19.6897H8.56897C8.20388 19.6917 7.84201 19.6212 7.50433 19.4824C7.16664 19.3436 6.85984 19.1392 6.60168 18.8811C6.34352 18.6229 6.13913 18.3161 6.00033 17.9785C5.86154 17.6408 5.79111 17.2789 5.7931 16.9138C5.7931 15.3688 7.024 14.1379 8.56897 14.1379H8.60862C8.70017 14.1381 8.78898 14.1067 8.85996 14.0489C8.93094 13.991 8.97972 13.9104 8.99803 13.8207C9.05119 13.5554 9.17149 13.3083 9.34744 13.1028C9.5234 12.8973 9.74911 12.7404 10.003 12.6471C10.2569 12.5538 10.5305 12.5271 10.7977 12.5697C11.0648 12.6123 11.3165 12.7227 11.5288 12.8904C11.5911 12.9391 11.6665 12.968 11.7454 12.9735C11.8243 12.9791 11.903 12.9609 11.9715 12.9213C12.0399 12.8818 12.095 12.8226 12.1296 12.7515C12.1642 12.6805 12.1768 12.6007 12.1657 12.5224C12.1483 12.4007 12.1391 12.2781 12.1379 12.1552C12.1378 11.7908 12.2096 11.4301 12.3491 11.0935C12.4886 10.7569 12.6932 10.4512 12.951 10.1938C13.2089 9.93636 13.515 9.73236 13.8518 9.59342C14.1886 9.45447 14.5495 9.38332 14.9138 9.38405C15.469 9.38405 16.0099 9.54982 16.4691 9.86072C16.5543 9.9187 16.6588 9.94117 16.7604 9.92341C16.862 9.90564 16.9526 9.84904 17.0131 9.76555C17.4538 9.15696 18.0322 8.66135 18.7012 8.31934C19.3702 7.97733 20.1107 7.79862 20.8621 7.79785V7.78991V7.7931ZM14.9074 20.8666C14.8554 20.8675 14.804 20.8786 14.7562 20.8993C14.7084 20.92 14.6651 20.9498 14.6289 20.9873C14.5927 21.0247 14.5641 21.0688 14.545 21.1173C14.5258 21.1657 14.5164 21.2174 14.5172 21.2695V26.8212C14.5172 26.9264 14.559 27.0273 14.6334 27.1017C14.7078 27.176 14.8086 27.2177 14.9138 27.2177C15.019 27.2177 15.1198 27.176 15.1942 27.1017C15.2686 27.0273 15.3103 26.9264 15.3103 26.8212V21.2695C15.3112 21.2163 15.3014 21.1635 15.2814 21.1143C15.2615 21.065 15.2318 21.0203 15.1942 20.9827C15.1567 20.9451 15.1119 20.9155 15.0626 20.8956C15.0134 20.8756 14.9606 20.8658 14.9074 20.8666ZM9.35572 21.2695C9.30365 21.2703 9.25224 21.2814 9.20445 21.3021C9.15665 21.3228 9.1134 21.3527 9.07716 21.3901C9.04093 21.4275 9.01242 21.4717 8.99326 21.5201C8.97411 21.5686 8.96468 21.6203 8.96552 21.6724V27.2241C8.96552 27.3293 9.0073 27.4301 9.08166 27.5045C9.15603 27.5789 9.2569 27.6207 9.36207 27.6207C9.46724 27.6207 9.56811 27.5789 9.64247 27.5045C9.71684 27.4301 9.75862 27.3293 9.75862 27.2241V21.6724C9.75948 21.6193 9.74964 21.5665 9.7297 21.5172C9.70975 21.468 9.68011 21.4232 9.64253 21.3856C9.60494 21.3481 9.56018 21.3184 9.51091 21.2984C9.46165 21.2785 9.40887 21.2686 9.35572 21.2695ZM20.4592 21.2695C20.4071 21.2703 20.3557 21.2814 20.3079 21.3021C20.2601 21.3228 20.2168 21.3527 20.1806 21.3901C20.1444 21.4275 20.1159 21.4717 20.0967 21.5201C20.0776 21.5686 20.0681 21.6203 20.069 21.6724V27.2241C20.069 27.3293 20.1107 27.4301 20.1851 27.5045C20.2595 27.5789 20.3603 27.6207 20.4655 27.6207C20.5707 27.6207 20.6716 27.5789 20.7459 27.5045C20.8203 27.4301 20.8621 27.3293 20.8621 27.2241V21.6724C20.8629 21.6193 20.8531 21.5665 20.8331 21.5172C20.8132 21.468 20.7836 21.4232 20.746 21.3856C20.7084 21.3481 20.6636 21.3184 20.6144 21.2984C20.5651 21.2785 20.5123 21.2686 20.4592 21.2695ZM12.1316 21.5328C12.0267 21.5345 11.9267 21.5776 11.8536 21.6529C11.7805 21.7281 11.7401 21.8292 11.7414 21.9341V24.4419C11.7414 24.5471 11.7832 24.648 11.8575 24.7224C11.9319 24.7967 12.0328 24.8384 12.1379 24.8384C12.2431 24.8384 12.344 24.7967 12.4183 24.7224C12.4927 24.648 12.5345 24.5471 12.5345 24.4419V21.9341C12.5351 21.8811 12.5251 21.8285 12.5051 21.7794C12.4851 21.7303 12.4554 21.6858 12.4178 21.6484C12.3802 21.611 12.3356 21.5814 12.2864 21.5616C12.2372 21.5417 12.1846 21.532 12.1316 21.5328ZM23.235 21.5328C23.1301 21.5345 23.0302 21.5776 22.957 21.6529C22.8839 21.7281 22.8436 21.8292 22.8448 21.9341V24.4419C22.8448 24.5471 22.8866 24.648 22.961 24.7224C23.0353 24.7967 23.1362 24.8384 23.2414 24.8384C23.3466 24.8384 23.4474 24.7967 23.5218 24.7224C23.5962 24.648 23.6379 24.5471 23.6379 24.4419V21.9341C23.6386 21.8811 23.6286 21.8285 23.6085 21.7794C23.5885 21.7303 23.5588 21.6858 23.5213 21.6484C23.4837 21.611 23.439 21.5814 23.3899 21.5616C23.3407 21.5417 23.288 21.532 23.235 21.5328ZM17.6833 21.6288C17.5784 21.6304 17.4785 21.6736 17.4053 21.7488C17.3322 21.824 17.2918 21.9252 17.2931 22.0301V25.139C17.2931 25.2442 17.3349 25.3451 17.4093 25.4194C17.4836 25.4938 17.5845 25.5356 17.6897 25.5356C17.7948 25.5356 17.8957 25.4938 17.9701 25.4194C18.0444 25.3451 18.0862 25.2442 18.0862 25.139V22.0301C18.0869 21.9771 18.0769 21.9245 18.0568 21.8754C18.0368 21.8264 18.0071 21.7818 17.9695 21.7443C17.932 21.7069 17.8873 21.6774 17.8381 21.6576C17.789 21.6378 17.7363 21.6279 17.6833 21.6288Z" fill="white" />
</g>
<defs>
<clipPath id="clip0_2008_1151">
<rect width="25" height="37" fill="white" />
</clipPath>
</defs>
</svg>`,
  iconSize: [25, 32],
  className: "marker-icon",
});

export const RainfallPostMarker = ({ activeRainfallPostMarker }) => {
  return (
    <>
      {initialRainfallPost.map((rainfallPost) =>
        activeRainfallPostMarker ? (
          <Marker
            key={rainfallPost.properties.id}
            position={[
              Number(rainfallPost.geometry.coordinates[1]),
              Number(rainfallPost.geometry.coordinates[0]),
            ]}
            icon={markerRainfallPost}
          >
            <Popup className="m-0">
              <Card>
                <CardHeader className="rounded-t-lg bg-[#7E7E7E] p-0">
                  <h3 className="p-2 text-center text-sm font-semibold text-white">
                    Pos Curah Hujan {""}
                    {rainfallPost.properties.pos_pengukuran.nama_lokasi ?? "-"}
                  </h3>
                </CardHeader>
                <CardContent className="p-2">
                  <div className="mb-1.5 flex items-center justify-between gap-x-3">
                    <h5 className="text-sm font-semibold text-gray-600">
                      {`${
                        rainfallPost.properties.tanggal
                          ? formatDate(
                              rainfallPost.properties.tanggal,
                              "dd MMMM yyy",
                            )
                          : "-"
                      } | ${rainfallPost.properties.jam ?? "-"}
                      `}
                    </h5>
                  </div>

                  <div className="mb-1.5">
                    <h6 className="text-sm font-bold text-gray-700">Pelapor</h6>
                    <h4 className="text-sm font-semibold text-gray-400">
                      {rainfallPost.properties.username ?? "-"}
                    </h4>
                  </div>

                  <div className="mb-1.5">
                    <h5 className="text-sm font-bold text-gray-700">
                      Periode {""}
                      <span className="text-sm font-semibold text-gray-400">
                        {rainfallPost.properties.periode !== null &&
                        rainfallPost.properties.periode !== undefined
                          ? rainfallPost.properties.periode == 1
                            ? "23.00 WIB - 07.00 WIB"
                            : rainfallPost.properties.periode == 2
                              ? "07.00 WIB - 15.00 WIB"
                              : rainfallPost.properties.periode == 3
                                ? "15.00 WIB - 23.00 WIB"
                                : "-"
                          : "-"}
                      </span>
                    </h5>
                  </div>

                  <div className="mb-1.5">
                    <h5 className="text-sm font-bold text-gray-700">
                      Itensitas Hujan{" "}
                      <span className="text-sm font-semibold text-gray-400">
                        {rainfallPost.properties.itensitas !== null &&
                        rainfallPost.properties.itensitas !== undefined
                          ? rainfallPost.properties.itensitas + " mm"
                          : "-"}
                      </span>
                    </h5>
                  </div>
                </CardContent>
              </Card>
            </Popup>
          </Marker>
        ) : null,
      )}
    </>
  );
};
